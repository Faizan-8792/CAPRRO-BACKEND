<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CA PRO Firm Admin</title>

  <!-- Bootstrap -->
  <link rel="stylesheet" href="bootstrap.min.css" />
  <link rel="stylesheet" href="admin.css" />
</head>
<body>

  <!-- TOP NAVBAR â€” IDs exactly as admin.js expects -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary topbar">
    <div class="container-fluid">
      <span class="navbar-brand mb-0 h1">CA PRO</span>

      <div class="d-flex flex-column flex-sm-row align-items-sm-center ms-auto gap-1">
        <span id="topSub" class="topbar-sub small-label">
          Loading firm...
        </span>
        <div class="d-flex align-items-center gap-2">
          <span id="emailBadge" class="badge rounded-pill px-3 py-2 small-label">
            -
          </span>
          <span id="roleBadge" class="badge rounded-pill px-3 py-2 small-label">
            -
          </span>
          <button id="logoutBtn" class="btn btn-sm btn-light ms-1">
            Logout
          </button>
        </div>
      </div>
    </div>
  </nav>

  <!-- LAYOUT -->
  <div class="layout">
    <!-- SIDEBAR â€” matches admin.js showPage/onHashChange -->
    <aside class="sidebar">
      <div class="px-3 mb-2 small-label text-muted">Navigation</div>
      <a href="#dashboard" class="active">Dashboard</a>
      <a href="#tasks">Compliance board</a>
      <a href="#assistant">Compliance Assistant</a>


      <a href="#firm">Firm profile</a>
      <a href="#users">Users</a>
      <a href="#join">Join code</a>
      <a href="#settings">Plan / Settings</a>
    </aside>

    <!-- CONTENT -->
    <main class="content">

      <!-- Pending approval banner -->
      <div id="pendingBanner" class="alert alert-warning d-none mb-3">
        <strong>Pending Approval</strong><br />
        Your firm admin access is pending Super Admin approval. View-only mode until approved.
      </div>

      <!-- DASHBOARD (page-dashboard) -->
      <section id="page-dashboard">
        <h4 class="mb-3">Dashboard</h4>

        <div class="row g-3 mb-4">
          <div class="col-md-4">
            <div class="card p-3">
              <div class="kpi">Firm</div>
              <div class="kpi-value" id="kpiFirmName">-</div>
              <div class="small-label" id="kpiFirmHandle">@handle</div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="card p-3">
              <div class="kpi">Total users</div>
              <div class="kpi-value" id="kpiTotalUsers">0</div>
              <div class="small-label">
                Active: <span id="kpiActiveUsers">0</span>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="card p-3">
              <div class="kpi">Plan</div>
              <div class="kpi-value" id="kpiPlanType">FREE</div>
              <div class="small-label" id="kpiPlanExpiry">Expires NA</div>
            </div>
          </div>
        </div>

        <!-- Last day notifications -->
        <div class="card p-3 mb-4">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <div>
              <div class="kpi">ðŸ“… Last Day Notifications</div>
              <div class="small-label">
                Reminders due tomorrow for client follow-ups.
              </div>
            </div>
          </div>
          <ul id="todayRemindersList" class="mb-2 small"></ul>
          <div id="todayRemindersStatus" class="small-label"></div>
        </div>

        <!-- Clients to Chase Today -->
        <section id="clientsToChaseCard" class="card">
          <h3>Clients to Chase Today</h3>
          <p class="muted">
            Auto-generated follow-up list from Tasks. Pending Docs shows items stuck in
            'Waiting Docs/Open' for 3+ days; High Risk shows clients late in the last periods.
            <br>
            Click Done to mark handled and remove from this list.
          </p>

          <div class="smart-section">
            <h4>Pending docs (above 3+ days)</h4>
            <div id="chasePendingStatus" class="status-text"></div>
            <ul id="chasePendingList" class="smart-list"></ul>
          </div>

          <div class="smart-section">
            <h4>Habitual late clients (High risk)</h4>
            <div id="chaseRiskStatus" class="status-text"></div>
            <ul id="chaseRiskList" class="smart-list"></ul>
          </div>
        </section>

      </section>

      <!-- TASK BOARD (page-tasks) -->
      <section id="page-tasks" style="display:none">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h4 class="mb-0">Compliance board</h4>
        </div>

        <!-- Add Task small form -->
        <div class="card p-3 mb-3">
          <div class="row g-2">
            <div class="col-md-3">
              <label class="form-label small-label">Client name</label>
              <input id="addTaskClient" type="text" class="form-control" />
            </div>
            <div class="col-md-2">
              <label class="form-label small-label">Service type</label>
              <select id="addTaskService" class="form-select">
                <option value="GST">GST</option>
                <option value="TDS">TDS</option>
                <option value="ITR">ITR</option>
                <option value="ROC">ROC</option>
                <option value="AUDIT">Audit</option>
                <option value="OTHER" selected>Other</option>
              </select>
            </div>
            <div class="col-md-3">
              <label class="form-label small-label">Title</label>
              <input id="addTaskTitle" type="text" class="form-control" />
            </div>
            <div class="col-md-2">
              <label class="form-label small-label">Due date</label>
              <input id="addTaskDue" type="date" class="form-control" />
            </div>
            <div class="col-md-2">
              <label class="form-label small-label">Assign to</label>
              <select id="addTaskAssignTo" class="form-select">
                <option value="">Unassigned</option>
              </select>
            </div>
          </div>

          <div class="row g-2 mt-2">
            <div class="col-md-3">
              <label class="form-label small-label">Initial status</label>
              <select id="addTaskStatusSelect" class="form-select">
                <option value="NOT_STARTED">NOT_STARTED</option>
                <option value="WAITING_DOCS">WAITING_DOCS</option>
                <option value="IN_PROGRESS">IN_PROGRESS</option>
                <option value="FILED">FILED</option>
                <option value="CLOSED">CLOSED</option>
              </select>
            </div>
            <div class="col-md-9 d-flex align-items-end justify-content-end">
              <button id="addTaskBtn" class="btn btn-primary btn-sm">
                Add task
              </button>
            </div>
          </div>

          <div id="addTaskStatus" class="small-label mt-2"></div>
        </div>

        <!-- Filters -->
        <div class="card p-3 mb-3">
          <div class="row g-2 align-items-end">
            <div class="col-md-3">
              <label class="form-label small-label">Service type</label>
              <select id="taskFilterService" class="form-select">
                <option value="">All</option>
                <option value="GST">GST</option>
                <option value="TDS">TDS</option>
                <option value="ITR">ITR</option>
                <option value="ROC">ROC</option>
                <option value="AUDIT">Audit</option>
                <option value="OTHER">Other</option>
              </select>
            </div>
            <div class="col-md-3">
              <label class="form-label small-label">Assigned staff</label>
              <select id="taskFilterStaff" class="form-select">
                <option value="">All</option>
              </select>
            </div>
            <div class="col-md-3">
              <label class="form-label small-label">Month (YYYY-MM)</label>
              <input id="taskFilterMonth" type="month" class="form-control" />
            </div>
            <div class="col-md-3 text-end">
              <button id="taskFilterApply" class="btn btn-primary btn-sm">
                Apply
              </button>
              <button id="taskFilterClear" class="btn btn-outline-secondary btn-sm">
                Clear
              </button>
            </div>
          </div>
          <div id="taskBoardStatus" class="small-label mt-2"></div>
        </div>

        <!-- Board columns -->
        <div id="taskBoardColumns" class="row g-3"></div>
      </section>

      <!-- COMPLIANCE ASSISTANT (page-assistant) -->
      <section id="page-assistant" style="display:none">
        <h4 class="mb-3">ðŸ§  Compliance Assistant</h4>

        <section id="adminComplianceAssistant" class="card">
          <p class="muted">
            Auto-prioritized compliance workload for today based on due dates,
            overdue status, and task risk signals.
          </p>

          <div class="d-flex flex-wrap gap-2 mb-3">
            <span class="badge bg-danger" id="caOverdueCount">Overdue: 0</span>
            <span class="badge bg-warning" id="caTodayCount">Due Today: 0</span>
            <span class="badge bg-primary" id="caUpcomingCount">Upcoming: 0</span>
          </div>

          <div id="caStatus" class="small-label mb-2">
            Loading today's compliance priorities...
          </div>

          <div class="table-responsive">
            <table class="table align-middle mb-0">
              <thead>
                <tr>
                  <th>Client</th>
                  <th>Service</th>
                  <th>Due Date</th>
                  <th>Assigned</th>
                  <th>Priority</th>
                </tr>
              </thead>
              <tbody id="caTaskTbody"></tbody>
            </table>
          </div>
        </section>
      </section>

      <!-- FIRM PROFILE (page-firm) -->
      <section id="page-firm" style="display:none">
        <h4 class="mb-3">Firm profile</h4>
        <div class="card p-3">
          <div class="row g-3">
            <div class="col-md-4">
              <label class="form-label small-label">Display name</label>
              <input id="firmDisplayName" type="text" class="form-control" />
            </div>
            <div class="col-md-4">
              <label class="form-label small-label">Handle</label>
              <input id="firmHandle" type="text" class="form-control" readonly />
            </div>
            <div class="col-md-4">
              <label class="form-label small-label">Practice areas</label>
              <input id="firmPracticeAreas" type="text" class="form-control" />
            </div>
          </div>
          <div class="mt-3">
            <label class="form-label small-label">Description</label>
            <textarea id="firmDescription" rows="3" class="form-control"></textarea>
          </div>
          <div class="mt-3 text-end">
            <button id="saveFirmBtn" class="btn btn-primary">Save</button>
          </div>
          <div id="firmStatus" class="small-label mt-2"></div>
        </div>
      </section>

      <!-- USERS (page-users) -->
      <section id="page-users" style="display:none">
        <h4 class="mb-3">Users</h4>
        <div class="card p-3">
          <div class="table-responsive">
            <table class="table align-middle mb-0">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Role</th>
                  <th>Account</th>
                  <th>Status</th>
                  <th>Created</th>
                </tr>
              </thead>
              <tbody id="usersTbody">
                <tr>
                  <td colspan="6" class="text-center text-muted">
                    Loading...
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- JOIN CODE (page-join) -->
      <section id="page-join" style="display:none">
        <h4 class="mb-3">Join code</h4>
        <div class="card p-3">
          <div class="row g-3">
            <div class="col-md-4">
              <label class="form-label small-label">Join code</label>
              <input id="joinCodeField" type="text" class="form-control join-input" readonly />
            </div>
            <div class="col-md-4 d-flex align-items-end gap-2">
              <button id="revealJoinBtn" class="btn btn-outline-secondary btn-sm">
                Reveal
              </button>
              <button id="copyJoinBtn" class="btn btn-outline-primary btn-sm">
                Copy
              </button>
              <button id="rotateJoinBtn" class="btn btn-outline-danger btn-sm">
                Rotate
              </button>
            </div>
          </div>

          <div class="row g-3 mt-3">
            <div class="col-md-4">
              <label class="form-label small-label">Custom join code</label>
              <input id="editJoinCode" type="text" class="form-control" />
            </div>
            <div class="col-md-3 d-flex align-items-end">
              <button id="saveJoinCodeBtn" class="btn btn-primary">
                Save
              </button>
            </div>
          </div>

          <div id="joinStatus" class="small-label mt-2"></div>
        </div>
      </section>

      <!-- SETTINGS / PLAN (page-settings) -->
      <section id="page-settings" style="display:none">
        <h4 class="mb-3">Plan Settings</h4>
        <div class="card p-3">
          <div class="row g-3">
            <div class="col-md-4">
              <label class="form-label small-label">Plan type</label>
              <input id="settingsPlanType" type="text" class="form-control" readonly />
            </div>
            <div class="col-md-4">
              <label class="form-label small-label">Plan expiry</label>
              <input id="settingsPlanExpiry" type="text" class="form-control" readonly />
            </div>
          </div>
        </div>
      </section>

    </main>
  </div>

  <!-- SCRIPTS -->
  <script src="admin.js"></script>
  <script src="admin-tasks.js"></script>
  <script type="module" src="compliance-assistant/assistant.js"></script>

</body>
</html>